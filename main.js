(()=>{"use strict";async function e(e){const t=`https://api.openweathermap.org/data/2.5/weather?units=metric&q=${e}&appid=458b6f24d9bec1db57c2f337dc35dbcc`,n=await fetch(t);return await n.json()}async function t(t){const n=t.target;if("P"!=n.tagName)return;const c=await e(n.innerText);await a(c)}function n(e){const n=document.querySelector(".history");n.addEventListener("click",t);const a=n.querySelectorAll("p");if(Array.from(a).map((e=>e.innerText)).includes(e))return;const c=document.createElement("p");c.innerText=e,n.insertBefore(c,a[0]),a.length>=10&&a[a.length-1].remove()}async function a(e){const t=document.querySelector(".weather");t.innerHTML="";const a=document.querySelector(".map");a.innerHTML="";const c=document.createElement("p");if(void 0===e.name)return c.innerText="Can't find this city, try again.",void t.appendChild(c);c.innerText=`Showing weather for ${e.name}`,t.appendChild(c);const r=document.createElement("p");r.innerText=`Current weather is ${e.main.temp} degrees of Celcium`,t.appendChild(r);const i=document.createElement("img"),o=e.weather[0].icon;i.src=`https://openweathermap.org/img/wn/${o}@2x.png`,t.appendChild(i);const s=document.createElement("img");s.src=`https://static-maps.yandex.ru/1.x/?ll=${e.coord.lon},${e.coord.lat}&size=450,450&z=11&l=map`,a.appendChild(s),n(e.name);let d=JSON.parse(localStorage.getItem("history"));d?.indexOf(e.name)&&d.push(e.name),localStorage.setItem("history",JSON.stringify(d))}async function c(e){const t=await fetch(e);return await t.json()}!async function(){!function(){let e=localStorage.getItem("history");e?JSON.parse(e).forEach((e=>{n(e)})):(e=[],localStorage.setItem("history",JSON.stringify(e)))}();const t=await async function(){const e=await c("https://get.geojs.io/v1/ip/geo.json"),t=e.latitude,n=e.longitude;return await c(`https://api.openweathermap.org/data/2.5/weather?units=metric&lat=${t}&lon=${n}&appid=458b6f24d9bec1db57c2f337dc35dbcc`)}();await a(t),document.querySelector("#submit").addEventListener("click",(async()=>{const t=document.querySelector(".city"),n=await e(t.value);await a(n)}))}()})();